<table id="mailpoet_role_permissions" class="widefat fixed">
  <thead>
    <tr>
      <th class="manage-column">
        <%= __('Roles and permissions') %>
      </th>
      <% for role in permissions.roles %>
        <th class="manage-column">
          <%= role %>
        </th>
      <% endfor %>
    </tr>
  </thead>
  <tbody>
    <% for capability in permissions.capabilities %>
    <tr class="<%= cycle(['alternate', ''], loop.index0) %>">
      <td>
        <%= capability.label %>
      </td>
      <% for role_key, role in capability.roles %>
      <td>
        <input
          class="mailpoet_role_permission"
          type="checkbox"
          data-role="<%= role_key %>"
          data-capability="<%= role.capability %>"
          value="1"
          <% if(role.is_capable) %>
            checked="checked"
          <% endif %>
          <% if(role.is_disabled) %>
            disabled="disabled"
          <% endif %>
        />
      </td>
      <% endfor %>
    </tr>
    <% endfor %>
  </tbody>
</table>

<table class="form-table">
  <tbody>
    <!-- bounce email -->
    <tr>
      <th scope="row">
        <label for="settings[bounce_email]">
          <%= __('Bounce email') %>
          <p class="description">
            <%= __('Your bounced emails will be sent to this address.') %>
          </p>
      </th>
      <td>
        <p>
          <input type="text"
            id="settings[bounce_email]"
            name="bounce[address]"
            value="<%= settings.bounce.address %>"
            placeholder="bounce@mydomain.com"
          />
        </p>
      </td>
    </tr>
    <!-- link tracking -->
    <tr>
      <th scope="row">
        <label>
          <%= __('Open and click tracking') %>
          <p class="description"><%= __('Some users prefer to not track their subscribers.') %></p>
      </th>
      <td>
        <p>
          <label>
            <input
                    type="radio"
                    name="tracking[enabled]"
                    value="1"
            <% if(settings.tracking.enabled) %>
            checked="checked"
            <% endif %>
            /><%= __('Yes') %>
          </label>
          &nbsp;
          <label>
            <input
                    type="radio"
                    name="tracking[enabled]"
                    value=""
            <% if not(settings.tracking.enabled) %>
            checked="checked"
            <% endif %>
            /><%= __('No') %>
          </label>
        </p>
      </td>
    </tr>
    <!-- share anonymous data? -->
    <tr>
      <th scope="row">
        <label>
          <%= __('Share anonymous data') %>
          <p class="description">
            <%= __('Share anonymous data and help us improve the plugin! We appreciate your help.') %>
            <a
              href="http://support.mailpoet.com/knowledgebase/share-your-data/?utm_source=wpadmin&utm_campaign=advanced_settings"
              target="_blank"
            ><%= __('Read more.') %></a>
          </p>
        </label>
      </th>
      <td>
        <p>
          <label>
            <input
              type="radio"
              name="analytics[enabled]"
              value="1"
              <% if(settings.analytics.enabled) %>
                checked="checked"
              <% endif %>
            /><%= __('Yes') %>
          </label>
          &nbsp;
          <label>
            <input
              type="radio"
              name="analytics[enabled]"
              value=""
              <% if not(settings.analytics.enabled) %>
                checked="checked"
              <% endif %>
            /><%= __('No') %>
          </label>
        </p>
      </td>
    </tr>
    <!-- charset -->
    <tr>
      <th scope="row">
        <label for="settings[charset]">
          <%= __('Charset') %>
          <p class="description">
            <%= __('Squares, circles, or other weird characters in your emails? Select the correct encoding for your language.') %>
          </p>
        </label>
      </th>
      <td>
        <p>
          <select
            id="settings[charset]"
            name="charset"
          >
            <% for charset in charsets %>
              <option
                value="<%= charset %>"
                <% if(settings.charset == charset) %>
                  selected="selected"
                <% endif %>
              ><%= charset %></option>
            <% endfor %>
          </select>
        </p>
      </td>
    </tr>
    <!-- debug mode -->
    <tr>
      <th scope="row">
        <label>
          <%= __('Debug mode') %>
          <p class="description">
            <%= __("Enable this to show MailPoet's errors. Our support might ask you to enable this if you seek their help.") %>
          </p>
        </label>
      </th>
      <td>
        <p>
          <label>
            <input
              type="radio"
              name="debug[enabled]"
              value="1"
              <% if(settings.debug.enabled) %>
                checked="checked"
              <% endif %>
            /><%= __('Yes') %>
          </label>
          &nbsp;
          <label>
            <input
              type="radio"
              name="debug[enabled]"
              value=""
              <% if not(settings.debug.enabled) %>
                checked="checked"
              <% endif %>
            /><%= __('No') %>
          </label>
        </p>
      </td>
    </tr>
    <!-- reinstall -->
    <tr>
      <th scope="row">
        <label><%= __('Reinstall from scratch') %>
        <p class="description"><%= __('Want to start from the beginning? This will completely wipe out MailPoet and reinstall from scratch.') %></p>
      </th>
      <td>
        <p>
          <a
            id="mailpoet_reinstall"
            class="button"
            href="javascript:;"><%= __('Reinstall now...') %></a>
        </p>
      </td>
    </tr>
  </tbody>
</table>

<script type="text/javascript">
  jQuery(function($) {
    $(function() {
      $('#mailpoet_reinstall').on('click', function() {
        if(confirm(
          "<%= __('If you continue, all of your current MailPoet data will be permanently erased (newsletters, statistics, subscribers, etc...)') %>"
        )) {
          MailPoet.Modal.loading(true);
          MailPoet.Ajax.post({
            'endpoint': 'setup',
            'action': 'reset'
          }).done(function(response) {
            if(response.result === true) {
              window.location = "<%= admin_url('admin.php?page=mailpoet-newsletters') %>";
            } else {
              MailPoet.Notice.error(
                "<%= __('MailPoet could not be reinstalled. You may need to remove it manually first.') %>",
              { scroll: true });
            }
          });
        }
        return false;
      });
    });
  });
</script>